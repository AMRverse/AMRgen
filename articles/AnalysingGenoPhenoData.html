<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>AnalysingGenoPhenoData • AMRgen</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="AnalysingGenoPhenoData">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AMRgen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-book-open"></span> Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/AnalysingGenoPhenoData.html"><span class="fa fa-book"></span> Vignettes</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/amrverse/AMRgen"><span class="fa fab fa-github"></span> Source Code</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>AnalysingGenoPhenoData</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/amrverse/AMRgen/blob/main/vignettes/AnalysingGenoPhenoData.Rmd" class="external-link"><code>vignettes/AnalysingGenoPhenoData.Rmd</code></a></small>
      <div class="d-none name"><code>AnalysingGenoPhenoData.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://amrverse.github.io/AMRgen/">AMRgen</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>AMRgen</code> is a comprehensive R package designed to
integrate antimicrobial resistance genotype and phenotype data. It
provides tools to:</p>
<ul>
<li><p>Import AMR genotype data (e.g. from AMRFinderPlus,
hAMRonization)</p></li>
<li><p>Import AST phenotype data (e.g. from NCBI)</p></li>
<li><p>Conduct genotype-phenotype analyses to explore the impact of
genotypic markers on phenotype, including via logistic regression, solo
marker analysis, and upset plots</p></li>
<li><p>Fetch MIC or disk zone reference distributions from
EUCAST</p></li>
</ul>
<p>This vignette walks through a basic workflow using example datasets
included in the <code>AMRgen</code> package, and explains how to wrangle
your own data files into the right formats to use the same workflow.</p>
<div class="section level3">
<h3 id="genotype-table">1. Genotype table<a class="anchor" aria-label="anchor" href="#genotype-table"></a>
</h3>
<p>The <code><a href="../reference/import_amrfp.html">import_amrfp()</a></code> function lets you load genotype data
from AMRFinderPlus outputs, and process it to generate an object with
the key columns needed to work with the <code>AMRgen</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example AMRfinderplus genotyping output</span></span>
<span><span class="va">ecoli_geno_raw</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 53,591 × 10</span></span></span>
<span><span class="co">#&gt;    Name    `Gene symbol` `Hierarchy node` `Element type` `Element subtype` Class</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> SAMN03… blaEC         blaEC            AMR            AMR               BETA…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SAMN03… acrF          acrF             AMR            AMR               EFFL…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> SAMN03… glpT_E448K    glpT             AMR            POINT             FOSF…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> SAMN03… floR          floR             AMR            AMR               PHEN…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> SAMN03… mdtM          mdtM             AMR            AMR               EFFL…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> SAMN03… blaTEM-1      blaTEM-1         AMR            AMR               BETA…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> SAMN03… sul2          sul2             AMR            AMR               SULF…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> SAMN03… aph(3'')-Ib   aph(3'')-Ib      AMR            AMR               AMIN…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> SAMN03… aph(6)-Id     aph(6)-Id        AMR            AMR               AMIN…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> SAMN03… tet(A)        tet(A)           AMR            AMR               TETR…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 53,581 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: Subclass &lt;chr&gt;, `% Coverage of reference sequence` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `% Identity to reference sequence` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Accession of closest sequence` &lt;chr&gt;</span></span></span>
<span></span>
<span><span class="co"># Load AMRfinderplus output</span></span>
<span><span class="co">#    (replace 'ecoli_geno_raw' with the filepath for any AMRfinderplus output)</span></span>
<span><span class="va">ecoli_geno</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_amrfp.html">import_amrfp</a></span><span class="op">(</span><span class="va">ecoli_geno_raw</span>, <span class="st">"Name"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Input is already a dataframe.</span></span>
<span><span class="co">#&gt; [1] "Need Method columns to assign to parse mutations and assign variation type"</span></span>
<span></span>
<span><span class="co"># Check the format of the processed genotype table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ecoli_geno</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 18</span></span></span>
<span><span class="co">#&gt;   Name      gene  mutation node  `variation type` marker marker.label drug_agent</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;ab&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> SAMN0317… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       blaEC <span style="color: #BB0000;">NA</span>               blaEC  <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> SAMN0317… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       acrF  <span style="color: #BB0000;">NA</span>               acrF   <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SAMN0317… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       glpT  <span style="color: #BB0000;">NA</span>               glpT_… <span style="color: #BB0000;">NA</span>           FOS       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> SAMN0317… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       floR  <span style="color: #BB0000;">NA</span>               floR   <span style="color: #BB0000;">NA</span>           CHL       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> SAMN0317… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       floR  <span style="color: #BB0000;">NA</span>               floR   <span style="color: #BB0000;">NA</span>           FLR       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> SAMN0317… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       mdtM  <span style="color: #BB0000;">NA</span>               mdtM   <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 10 more variables: drug_class &lt;chr&gt;, `Gene symbol` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Hierarchy node` &lt;chr&gt;, `Element type` &lt;chr&gt;, `Element subtype` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Class &lt;chr&gt;, Subclass &lt;chr&gt;, `% Coverage of reference sequence` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `% Identity to reference sequence` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Accession of closest sequence` &lt;chr&gt;</span></span></span></code></pre></div>
<p>The genotype table has one row for each genetic marker detected in an
input genome, i.e. one per strain/marker combination.</p>
<p>If your genotype data is not in AMRfinderplus format, you can wrangle
other input data files into the necessary format.</p>
<p>The essential columns for a genotype table to work with
<code>AMRgen</code> functions are:</p>
<ul>
<li><p><code>Name</code>: character string giving the sample name, used
to link to sample names in the phenotype file (this column can have a
different name, in which case you’ll need to make sure it is the first
column in the dataframe OR pass its name to the functions using
<code>geno_sample_col</code>)</p></li>
<li><p><code>marker</code>: character string giving the name of the
genetic marker detected</p></li>
<li><p><code>drug_class</code>: character string giving the antibiotic
class associated with this marker</p></li>
</ul>
<p>NOTE: You should consider whether you have genomes with no AMR
markers detected by genotyping, and how to make sure these are include
in your analyses. E.g. AMRfinderplus will output one row per
genome/marker combination, but if you have a genome with no markers
detected, there will be no row at all for that genome in the
concatenated output file. If your species has core genes included in
AMRfinderplus this probably won’t be a problem as you would expect some
calls for every genome (e.g. AMRfinderplus will report blaSHV, oqxA,
oqxB, fosA in all Klebsiella pneumoniae genomes, so all input genomes
will appear in the concatenated output file). An easy solution is to run
a check to make sure that all genome names in your input dataset are
represented in the genotype table, and if any are missing add empty rows
for these using
e.g. <code>tibble(Name=missing_samples) %&gt;% bind_rows(genotype_table)</code>.</p>
</div>
<div class="section level3">
<h3 id="phenotype-table">2. Phenotype table<a class="anchor" aria-label="anchor" href="#phenotype-table"></a>
</h3>
<p>The <code><a href="../reference/import_ncbi_ast.html">import_ncbi_ast()</a></code> function imports AST data from
NCBI format files.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example E. coli AST data from NCBI</span></span>
<span><span class="co"># This one has already been imported and phenotypes interpreted from assay data</span></span>
<span><span class="co"># You can make your own from NCBI format data using:</span></span>
<span><span class="co">#    import_ncbi_ast("filepath/AST.tsv", interpret=T)</span></span>
<span><span class="va">ecoli_ast</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15,320 × 24</span></span></span>
<span><span class="co">#&gt;    id           spp_pheno    drug_agent ecoff pheno     mic  disk guideline</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;mo&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;ab&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;sir&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;mic&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dsk&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> SAMN36015110 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span> <span style="color: #555555;">&lt;</span>128<span style="color: #555555;">.00</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SAMN07988997 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI IPM        NWT   <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  <span style="color: #555555;">&lt;=</span>1<span style="color: #555555;">.00</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> SAMN11638310 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>  256<span style="color: #555555;">.00</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> SAMN05729964 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>   64<span style="color: #555555;">.00</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> SAMN18634044 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>  <span style="color: #555555;">&lt;=</span>1<span style="color: #555555;">.00</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> SAMN26232716 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        <span style="color: #BB0000;">NA</span>    <span style="color: #B2B2B2;">  NA</span>       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> SAMN26232716 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>      <span style="color: #BB0000;">NA</span>    20 CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> SAMN10620111 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>  <span style="color: #555555;">&gt;=</span>4<span style="color: #555555;">.00</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> SAMN10620168 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>  <span style="color: #555555;">&gt;=</span>4<span style="color: #555555;">.00</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> SAMN10620104 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  <span style="color: #555555;">&lt;=</span>0.25    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15,310 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 16 more variables: `Organism group` &lt;chr&gt;, `Scientific name` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Isolation type` &lt;chr&gt;, Location &lt;chr&gt;, `Isolation source` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Isolate &lt;chr&gt;, Antibiotic &lt;chr&gt;, `Resistance phenotype` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Measurement sign` &lt;chr&gt;, `MIC (mg/L)` &lt;dbl&gt;, `Disk diffusion (mm)` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Laboratory typing platform` &lt;chr&gt;, Vendor &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Laboratory typing method version or reagent` &lt;chr&gt;, …</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ecoli_ast</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 24</span></span></span>
<span><span class="co">#&gt;   id           spp_pheno    drug_agent ecoff pheno   mic  disk guideline</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;mo&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;ab&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;sir&gt;</span> <span style="color: #949494; font-style: italic;">&lt;mic&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dsk&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> SAMN36015110 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>  <span style="color: #555555;">&lt;</span>128    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> SAMN07988997 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI IPM        NWT   <span style="color: #080808; background-color: #5FD7AF;">  S  </span>   <span style="color: #555555;">&lt;=</span>1    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SAMN11638310 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>   256    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> SAMN05729964 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>    64    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> SAMN18634044 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        NWT   <span style="color: #080808; background-color: #FFAFAF;">  R  </span>   <span style="color: #555555;">&lt;=</span>1    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> SAMN26232716 <span style="color: #949494;">B_</span>ESCHR<span style="color: #949494;">_</span>COLI CIP        <span style="color: #BB0000;">NA</span>    <span style="color: #B2B2B2;">  NA</span>     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> CLSI     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 16 more variables: `Organism group` &lt;chr&gt;, `Scientific name` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Isolation type` &lt;chr&gt;, Location &lt;chr&gt;, `Isolation source` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Isolate &lt;chr&gt;, Antibiotic &lt;chr&gt;, `Resistance phenotype` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Measurement sign` &lt;chr&gt;, `MIC (mg/L)` &lt;dbl&gt;, `Disk diffusion (mm)` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Laboratory typing platform` &lt;chr&gt;, Vendor &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Laboratory typing method version or reagent` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Testing standard` &lt;chr&gt;, `Create date` &lt;dttm&gt;</span></span></span></code></pre></div>
<p>The phenotype table has one row for each assay measurement, i.e. one
per strain/drug combination. If your assay data is not in NCBI AST
format, you can wrangle other input data files into the necessary
format.</p>
<p>The essential columns for a phenotype table to work with
<code>AMRgen</code> functions are:</p>
<ul>
<li><p><code>id</code>: character string giving the sample name, used to
link to sample names in the genotype file (this column can have a
different name, in which case you’ll need to make sure it is the first
column in the dataframe OR pass its name to the functions using
<code>pheno_sample_col</code>)</p></li>
<li><p><code>spp_pheno</code>: species in the form of an AMR package
<code>mo</code> class (can be created from a column with species name as
string, using <code>AMR::as.mo(species_string)</code>)</p></li>
<li><p><code>drug_agent</code>: antibiotic name in the form of an AMR
package <code>ab</code> class (can be created from a column with
antibiotic name as string, using
<code>AMR::as.ab(antibiotic_string)</code>)</p></li>
<li><p><code>pheno</code>: S/I/R phenotype calls in the form of an AMR
package <code>sir</code> class (can be created from a column with
phenotype values as string, using <code>AMR::as(sir_string)</code>, or
generated by interpreting MIC or disk assay data using
<code><a href="https://amr-for-r.org/reference/as.sir.html" class="external-link">AMR::as.sir</a></code>)</p></li>
</ul>
<p>If you want to do analyses with raw assay data (e.g. upset plots) you
will need that data in one or both of:</p>
<ul>
<li><p><code>mic</code>: MIC in the form of an AMR package
<code>mic</code> class (can be created from a column with assay values
as string, using <code>AMR::as.mic(mic_string)</code>)</p></li>
<li><p><code>disk</code>: disk diffusion zone diameter in the form of an
AMR package <code>disk</code> class (can be created from a column with
assay values as string, using
<code>AMR::as.disk(disk_string)</code>)</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="combine-genotype-and-phenotype-data-for-a-given-drug">3. Combine genotype and phenotype data for a given drug<a class="anchor" aria-label="anchor" href="#combine-genotype-and-phenotype-data-for-a-given-drug"></a>
</h3>
<p>The genotype and phenotype tables can include data related to many
different drugs, but we need to analyse things one drug at a time. The
function <code><a href="../reference/get_binary_matrix.html">get_binary_matrix()</a></code> can be used to extract
phenotype data for a specified drug, and genotype data for markers
associated with a specified drug class. It returns a single dataframe
with one row per strain, for the subset of strains that appear in both
the genotype and phenotype input tables. Each row indicates, for one
strain, both the phenotypes (with SIR column, any assay columns if
desired, and boolean 1/0 coding of R and NWT status) and the genotypes
(one column per marker, with boolean 1/0 coding of marker
presence/absence).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get matrix combining phenotype data for ciprofloxacin, binary calls for R/NWT phenotype,</span></span>
<span><span class="co">#    and genotype presence/absence data for all markers associated with the relevant drug</span></span>
<span><span class="co">#    class (which are labelled "Quinolones" in AMRfinderplus).</span></span>
<span><span class="va">cip_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_binary_matrix.html">get_binary_matrix</a></span><span class="op">(</span><span class="va">ecoli_geno</span>, <span class="va">ecoli_ast</span>, antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>, drug_class_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Quinolones"</span><span class="op">)</span>, sir_col <span class="op">=</span> <span class="st">"pheno"</span>, keep_assay_values <span class="op">=</span> <span class="cn">T</span>, keep_assay_values_from <span class="op">=</span> <span class="st">"mic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Some samples had multiple phenotype rows, taking the most resistant only"</span></span>
<span><span class="co">#&gt; [1] "Defining NWT using ecoff column provided: ecoff"</span></span>
<span></span>
<span><span class="co"># check format</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cip_bin</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 50</span></span></span>
<span><span class="co">#&gt;   id           pheno     mic     R   NWT gyrA_S83L gyrA_D87Y gyrA_D87N parC_S80I</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;sir&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;mic&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> SAMN03177615 <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> SAMN03177616 <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SAMN03177617 <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> SAMN03177618 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>   0.25<span style="color: #555555;">0</span>     0     0         1         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> SAMN03177619 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>   0.12<span style="color: #555555;">0</span>     0     0         0         1         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> SAMN03177620 <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 41 more variables: parE_S458A &lt;dbl&gt;, parC_S80R &lt;dbl&gt;, parE_L416F &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   qnrB6 &lt;dbl&gt;, gyrA_D87G &lt;dbl&gt;, parC_S57T &lt;dbl&gt;, parC_E84A &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   soxS_A12S &lt;dbl&gt;, qnrB2 &lt;dbl&gt;, qnrS2 &lt;dbl&gt;, parC_E84K &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parC_A56T &lt;dbl&gt;, qnrB19 &lt;dbl&gt;, `aac(6')-Ib-cr5` &lt;dbl&gt;, parC_E84V &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parE_I529L &lt;dbl&gt;, parE_S458T &lt;dbl&gt;, parE_E460D &lt;dbl&gt;, parC_E84G &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   qnrS1 &lt;dbl&gt;, marR_S3N &lt;dbl&gt;, `aac(6')-Ib-cr` &lt;dbl&gt;, soxR_R20H &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   qnrB1 &lt;dbl&gt;, parE_I355T &lt;dbl&gt;, soxR_G121D &lt;dbl&gt;, qnrB4 &lt;dbl&gt;, qepA &lt;dbl&gt;, …</span></span></span>
<span></span>
<span><span class="co"># list colnames, to see full list of quinolone markers included</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cip_bin</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id"             "pheno"          "mic"            "R"             </span></span>
<span><span class="co">#&gt;  [5] "NWT"            "gyrA_S83L"      "gyrA_D87Y"      "gyrA_D87N"     </span></span>
<span><span class="co">#&gt;  [9] "parC_S80I"      "parE_S458A"     "parC_S80R"      "parE_L416F"    </span></span>
<span><span class="co">#&gt; [13] "qnrB6"          "gyrA_D87G"      "parC_S57T"      "parC_E84A"     </span></span>
<span><span class="co">#&gt; [17] "soxS_A12S"      "qnrB2"          "qnrS2"          "parC_E84K"     </span></span>
<span><span class="co">#&gt; [21] "parC_A56T"      "qnrB19"         "aac(6')-Ib-cr5" "parC_E84V"     </span></span>
<span><span class="co">#&gt; [25] "parE_I529L"     "parE_S458T"     "parE_E460D"     "parC_E84G"     </span></span>
<span><span class="co">#&gt; [29] "qnrS1"          "marR_S3N"       "aac(6')-Ib-cr"  "soxR_R20H"     </span></span>
<span><span class="co">#&gt; [33] "qnrB1"          "parE_I355T"     "soxR_G121D"     "qnrB4"         </span></span>
<span><span class="co">#&gt; [37] "qepA"           "gyrA_S83A"      "qnrA1"          "parE_D475E"    </span></span>
<span><span class="co">#&gt; [41] "parC_A108V"     "qepA1"          "parE_E460K"     "gyrA_S83W"     </span></span>
<span><span class="co">#&gt; [45] "qnrB7"          "marR_R77C"      "parE_L445H"     "parE_I464F"    </span></span>
<span><span class="co">#&gt; [49] "qnrB"           "acrR_R45C"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-a-binary-drug-phenotype-using-genetic-marker-presenceabsence-data">4. Model a binary drug phenotype using genetic marker
presence/absence data<a class="anchor" aria-label="anchor" href="#model-a-binary-drug-phenotype-using-genetic-marker-presenceabsence-data"></a>
</h3>
<p>Logistic regression models can be informative to get an overview of
the association between a drug resistance phenotype, and each marker
thought to be associated with the relevant drug class.</p>
<p>The <code><a href="../reference/amr_logistic.html">amr_logistic()</a></code> function uses the
<code>get_binary_matrix</code> function to generate binary-coded
genotype and phenotype data for a specified drug and class; and fits two
logistic regression models of the form
<code>R ~ marker1 + marker2 + marker3 + ...</code> and
<code>NWT ~ marker1 + marker2 + marker3 + ...</code>.</p>
<p>Note that the ‘NWT’ variable in the latter model can be taken either
from a precomputed ECOFF-based call of WT=wildtype/NWT=nonwildtype
(encoded in the input column <code>ecoff_col</code>), or computed from
the S/I/R phenotype as NWT=R/I and WT=S.</p>
<p>The <code><a href="../reference/amr_logistic.html">amr_logistic()</a></code> function can fit the model using
either the standard logistic regression approach implemented in the
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function, or Firth’s bias-reduced
penalized-likelihood logistic regression implemented in the
<code>logistf</code> package. The default is to use Firth’s regression,
as standard logistic regression can fail if there are too observations
in some subgroups, which happens quite often with this kind of data. To
use <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> instead, set <code>glm=TRUE</code>.</p>
<p>The function also filters out markers with too few observations in
the combined genotype/phenotype dataset. The default minimum is 10 but
this can be changed using the <code>maf</code> parameter (maf stands for
‘minor allele frequency’). If you are having trouble fitting models, it
may be because too many markers and combinations have very few
observations, and you might try increasing the <code>maf</code> value to
ensure that rare markers are excluded prior to model fitting.</p>
<p>Using this modelling approach, a negative assocation with a single
marker and phenotype call of R and NWT is a strong indication that
marker does not contribute to resistance. Note however that a positive
association between a marker and R or NWT does not necessarily imply the
marker is independently contributing to the resistance phenotype, as
there may be non-independence between markersthat is not adequately
adjusted for by the model.</p>
<p>The function returns 4 objects:</p>
<ul>
<li><p><code>modelR, modelNWT</code>: data frames summarising each
model, with beta coefficient, lower and upper values of 95% confidence
intervals, and p-value for each marker (generated from the raw model
output using <code><a href="../reference/logistf_details.html">logistf_details()</a></code> or
<code><a href="../reference/glm_details.html">glm_details()</a></code> as relevant)</p></li>
<li><p><code>plot</code>: a ggplot2 object generated from the
<code>modelR</code> and <code>modelNWT</code> objects using the
<code><a href="../reference/compare_estimates.html">compare_estimates()</a></code> function</p></li>
<li><p><code>bin_mat</code>: the binary matrix used as input to the
regression models</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Manually run Firth's logistic regression model using the binary matrix produced above</span></span>
<span><span class="va">dataR</span> <span class="op">&lt;-</span> <span class="va">cip_bin</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cip_bin</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"pheno"</span>, <span class="st">"mic"</span>, <span class="st">"NWT"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">modelR</span> <span class="op">&lt;-</span> <span class="fu">logistf</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/logistf/man/logistf.html" class="external-link">logistf</a></span><span class="op">(</span><span class="va">R</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">dataR</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in logistf::logistf(R ~ ., data = dataR): logistf.fit: Maximum number</span></span>
<span><span class="co">#&gt; of iterations for full model exceeded. Try to increase the number of iterations</span></span>
<span><span class="co">#&gt; or alter step size by passing 'logistf.control(maxit=..., maxstep=...)' to</span></span>
<span><span class="co">#&gt; parameter control</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modelR</span><span class="op">)</span></span>
<span><span class="co">#&gt; logistf::logistf(formula = R ~ ., data = dataR)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model fitted by Penalized ML</span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                         coef  se(coef)   lower 0.95 upper 0.95        Chisq</span></span>
<span><span class="co">#&gt; (Intercept)      -4.96390507 0.1811448  -5.34017910 -4.6231446          Inf</span></span>
<span><span class="co">#&gt; gyrA_S83L         4.11280948 0.2272604   3.67076498  4.5689857          Inf</span></span>
<span><span class="co">#&gt; gyrA_D87Y         2.80024435 0.9652413   0.47378680  4.6457032 5.280028e+00</span></span>
<span><span class="co">#&gt; gyrA_D87N         3.62098439 0.7709538   1.74841360  5.0668148 1.118989e+01</span></span>
<span><span class="co">#&gt; parC_S80I         3.96648770 1.3787998   1.89258911  8.8299875 2.247148e+01</span></span>
<span><span class="co">#&gt; parE_S458A       -3.48867207 1.6042039  -8.54898079 -0.5324673 5.988137e+00</span></span>
<span><span class="co">#&gt; parC_S80R         1.71325782 0.9385031   0.05191566  4.0315534 4.108450e+00</span></span>
<span><span class="co">#&gt; parE_L416F        1.91056416 1.6262212  -1.44814273  6.9152611 1.470118e+00</span></span>
<span><span class="co">#&gt; qnrB6             4.52952457 1.2592524   1.65349298  7.1835449 8.065719e+00</span></span>
<span><span class="co">#&gt; gyrA_D87G         1.55333099 1.4956678  -6.98907726  3.9394371 4.225022e-01</span></span>
<span><span class="co">#&gt; parC_S57T        -1.13436499 1.4203029  -5.23754021  1.3915663 5.101399e-01</span></span>
<span><span class="co">#&gt; parC_E84A        -5.70441041 2.2070287 -11.29721113 -0.1323417 3.971922e+00</span></span>
<span><span class="co">#&gt; soxS_A12S         2.13648042 1.3286588  -0.66203438  4.9842385 1.987397e+00</span></span>
<span><span class="co">#&gt; qnrB2             2.44199360 1.5962790  -7.75945152  5.1604273 1.289487e+00</span></span>
<span><span class="co">#&gt; qnrS2            -2.00673705 2.1305732  -7.43942342  6.8150128 6.985621e-01</span></span>
<span><span class="co">#&gt; parC_E84K        -5.71832108 2.7625239 -12.33010980  0.7827491 3.094908e+00</span></span>
<span><span class="co">#&gt; parC_A56T         2.37563231 1.4855542  -5.28098230  4.5695832 6.320247e-01</span></span>
<span><span class="co">#&gt; qnrB19            4.71475162 0.4005202   3.91716136  5.5054620          Inf</span></span>
<span><span class="co">#&gt; `aac(6')-Ib-cr5` -0.15833425 0.7260696  -1.72410982  1.5871315 3.801923e-02</span></span>
<span><span class="co">#&gt; parC_E84V        -3.23416018 1.7711701  -8.43712948  0.2806570 3.262335e+00</span></span>
<span><span class="co">#&gt; parE_I529L        1.90275405 0.3016164   1.30556855  2.5034222 3.918613e+01</span></span>
<span><span class="co">#&gt; parE_S458T       -4.28790735 2.1477103  -9.77270323  1.2196570 2.655964e+00</span></span>
<span><span class="co">#&gt; parE_E460D       -3.79866238 2.1030072  -9.21744527  1.6368531 2.259181e+00</span></span>
<span><span class="co">#&gt; parC_E84G         1.93913364 1.6389863  -1.17354599  6.9343461 1.627272e+00</span></span>
<span><span class="co">#&gt; qnrS1             4.62335756 0.3515918   3.92721260  5.3173640          Inf</span></span>
<span><span class="co">#&gt; marR_S3N          1.34304342 0.2659083   0.80901622  1.8663526 2.288652e+01</span></span>
<span><span class="co">#&gt; `aac(6')-Ib-cr`  -4.30635808 1.8379077  -7.84380488  0.8539635 3.001890e+00</span></span>
<span><span class="co">#&gt; soxR_R20H        -5.81488017 2.2224293 -11.30563868 -0.3592767 4.196651e+00</span></span>
<span><span class="co">#&gt; qnrB1            -1.03326877 1.7233519  -4.24068024  5.3382336 1.418020e-01</span></span>
<span><span class="co">#&gt; parE_I355T        1.02709526 0.6715214  -0.40520437  2.3225745 2.049858e+00</span></span>
<span><span class="co">#&gt; soxR_G121D       -2.97288926 1.1081794  -5.22642088 -0.4070150 4.895143e+00</span></span>
<span><span class="co">#&gt; qnrB4             4.17537609 0.7837062   2.42602120  5.6429731 1.392998e+01</span></span>
<span><span class="co">#&gt; qepA             -9.71337827 3.0807874 -17.15799224 -2.8201977 6.619549e+00</span></span>
<span><span class="co">#&gt; gyrA_S83A         1.66806821 1.4515121  -3.19180388  3.7277821 8.393209e-01</span></span>
<span><span class="co">#&gt; qnrA1             3.35446716 1.5597479  -1.58044493  5.8907270 2.294695e+00</span></span>
<span><span class="co">#&gt; parE_D475E       -0.33734293 0.7214083  -2.08073197  0.9305620 2.182499e-01</span></span>
<span><span class="co">#&gt; parC_A108V       -2.14924472 1.7304455  -5.32647631  2.9202773 1.089096e+00</span></span>
<span><span class="co">#&gt; qepA1            -1.07546566 1.8773877  -5.11567232  4.8141372 1.572823e-01</span></span>
<span><span class="co">#&gt; parE_E460K       -4.81702417 2.3266297 -10.49147703  0.8547559 3.009358e+00</span></span>
<span><span class="co">#&gt; gyrA_S83W        10.87954154 2.8555865   4.62377311 17.5616932 8.436158e+00</span></span>
<span><span class="co">#&gt; qnrB7             6.06251736 1.6430095   3.11145478 11.0538683 1.259767e+01</span></span>
<span><span class="co">#&gt; marR_R77C         0.04695384 1.6545330  -2.92831420  5.0478355 8.109452e-04</span></span>
<span><span class="co">#&gt; parE_L445H       -5.88907864 1.8237009 -11.12464450 -2.3249701 1.023072e+01</span></span>
<span><span class="co">#&gt; parE_I464F       -4.79046635 2.1585223 -10.25943106  0.6897515 3.165628e+00</span></span>
<span><span class="co">#&gt; qnrB              6.06251736 1.6430095   3.11145478 11.0538683 1.259767e+01</span></span>
<span><span class="co">#&gt; acrR_R45C        -1.32835211 1.8735607  -4.96320806  3.8738455 4.249534e-01</span></span>
<span><span class="co">#&gt;                             p method</span></span>
<span><span class="co">#&gt; (Intercept)      0.000000e+00      2</span></span>
<span><span class="co">#&gt; gyrA_S83L        0.000000e+00      2</span></span>
<span><span class="co">#&gt; gyrA_D87Y        2.157140e-02      2</span></span>
<span><span class="co">#&gt; gyrA_D87N        8.224427e-04      2</span></span>
<span><span class="co">#&gt; parC_S80I        2.132864e-06      2</span></span>
<span><span class="co">#&gt; parE_S458A       1.440240e-02      2</span></span>
<span><span class="co">#&gt; parC_S80R        4.266945e-02      2</span></span>
<span><span class="co">#&gt; parE_L416F       2.253270e-01      2</span></span>
<span><span class="co">#&gt; qnrB6            4.511057e-03      2</span></span>
<span><span class="co">#&gt; gyrA_D87G        5.156911e-01      2</span></span>
<span><span class="co">#&gt; parC_S57T        4.750783e-01      2</span></span>
<span><span class="co">#&gt; parC_E84A        4.626492e-02      2</span></span>
<span><span class="co">#&gt; soxS_A12S        1.586133e-01      2</span></span>
<span><span class="co">#&gt; qnrB2            2.561426e-01      2</span></span>
<span><span class="co">#&gt; qnrS2            4.032673e-01      2</span></span>
<span><span class="co">#&gt; parC_E84K        7.853759e-02      2</span></span>
<span><span class="co">#&gt; parC_A56T        4.266136e-01      2</span></span>
<span><span class="co">#&gt; qnrB19           0.000000e+00      2</span></span>
<span><span class="co">#&gt; `aac(6')-Ib-cr5` 8.454045e-01      2</span></span>
<span><span class="co">#&gt; parC_E84V        7.088814e-02      2</span></span>
<span><span class="co">#&gt; parE_I529L       3.852672e-10      2</span></span>
<span><span class="co">#&gt; parE_S458T       1.031622e-01      2</span></span>
<span><span class="co">#&gt; parE_E460D       1.328243e-01      2</span></span>
<span><span class="co">#&gt; parC_E84G        2.020808e-01      2</span></span>
<span><span class="co">#&gt; qnrS1            0.000000e+00      2</span></span>
<span><span class="co">#&gt; marR_S3N         1.718527e-06      2</span></span>
<span><span class="co">#&gt; `aac(6')-Ib-cr`  8.316743e-02      2</span></span>
<span><span class="co">#&gt; soxR_R20H        4.050389e-02      2</span></span>
<span><span class="co">#&gt; qnrB1            7.064961e-01      2</span></span>
<span><span class="co">#&gt; parE_I355T       1.522204e-01      2</span></span>
<span><span class="co">#&gt; soxR_G121D       2.693235e-02      2</span></span>
<span><span class="co">#&gt; qnrB4            1.897475e-04      2</span></span>
<span><span class="co">#&gt; qepA             1.008654e-02      2</span></span>
<span><span class="co">#&gt; gyrA_S83A        3.595911e-01      2</span></span>
<span><span class="co">#&gt; qnrA1            1.298167e-01      2</span></span>
<span><span class="co">#&gt; parE_D475E       6.403767e-01      2</span></span>
<span><span class="co">#&gt; parC_A108V       2.966715e-01      2</span></span>
<span><span class="co">#&gt; qepA1            6.916710e-01      2</span></span>
<span><span class="co">#&gt; parE_E460K       8.278508e-02      2</span></span>
<span><span class="co">#&gt; gyrA_S83W        3.678326e-03      2</span></span>
<span><span class="co">#&gt; qnrB7            3.862287e-04      2</span></span>
<span><span class="co">#&gt; marR_R77C        9.772816e-01      2</span></span>
<span><span class="co">#&gt; parE_L445H       1.381204e-03      2</span></span>
<span><span class="co">#&gt; parE_I464F       7.520350e-02      2</span></span>
<span><span class="co">#&gt; qnrB             3.862287e-04      2</span></span>
<span><span class="co">#&gt; acrR_R45C        5.144757e-01      2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Method: 1-Wald, 2-Profile penalized log-likelihood, 3-None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=3665.555 on 45 df, p=0, n=5258</span></span>
<span><span class="co">#&gt; Wald test = 999.5128 on 45 df, p = 0</span></span>
<span></span>
<span><span class="co"># Extract model summary details using `logistf_details()`</span></span>
<span><span class="va">modelR_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logistf_details.html">logistf_details</a></span><span class="op">(</span><span class="va">modelR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">modelR_summary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 46 × 5</span></span></span>
<span><span class="co">#&gt;    marker        est ci.lower ci.upper       pval</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> (Intercept) -<span style="color: #BB0000;">4.96</span>  -<span style="color: #BB0000;">5.34</span>     -<span style="color: #BB0000;">4.62</span>  0         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> gyrA_S83L    4.11   3.67      4.57  0         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> gyrA_D87Y    2.80   0.474     4.65  0.021<span style="text-decoration: underline;">6</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> gyrA_D87N    3.62   1.75      5.07  0.000<span style="text-decoration: underline;">822</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> parC_S80I    3.97   1.89      8.83  0.000<span style="text-decoration: underline;">002</span>13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> parE_S458A  -<span style="color: #BB0000;">3.49</span>  -<span style="color: #BB0000;">8.55</span>     -<span style="color: #BB0000;">0.532</span> 0.014<span style="text-decoration: underline;">4</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> parC_S80R    1.71   0.051<span style="text-decoration: underline;">9</span>    4.03  0.042<span style="text-decoration: underline;">7</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> parE_L416F   1.91  -<span style="color: #BB0000;">1.45</span>      6.92  0.225     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> qnrB6        4.53   1.65      7.18  0.004<span style="text-decoration: underline;">51</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> gyrA_D87G    1.55  -<span style="color: #BB0000;">6.99</span>      3.94  0.516     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 36 more rows</span></span></span>
<span><span class="co">#&gt; Use ggplot2::autoplot() on this output to visualise</span></span>
<span></span>
<span><span class="co"># Plot the point estimates and 95% confidence intervals of the model</span></span>
<span><span class="fu"><a href="../reference/plot_estimates.html">plot_estimates</a></span><span class="op">(</span><span class="va">modelR_summary</span><span class="op">)</span></span></code></pre></div>
<p><img src="AnalysingGenoPhenoData_files/figure-html/manual_logistic-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Alternatively, use the amr_logistic() function to model R and NWT and plot the results together</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amr_logistic.html">amr_logistic</a></span><span class="op">(</span></span>
<span>  geno_table <span class="op">=</span> <span class="fu"><a href="../reference/import_amrfp.html">import_amrfp</a></span><span class="op">(</span><span class="va">ecoli_geno_raw</span>, <span class="st">"Name"</span><span class="op">)</span>, pheno_table <span class="op">=</span> <span class="va">ecoli_ast</span>,</span>
<span>  antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>, drug_class_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Quinolones"</span><span class="op">)</span>, maf <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Input is already a dataframe.</span></span>
<span><span class="co">#&gt; [1] "Need Method columns to assign to parse mutations and assign variation type"</span></span>
<span><span class="co">#&gt; [1] "Some samples had multiple phenotype rows, taking the most resistant only"</span></span>
<span><span class="co">#&gt; [1] "Defining NWT using ecoff column provided: ecoff"</span></span>
<span><span class="co">#&gt; [1] "Fitting logistic regression models using logistf"</span></span></code></pre></div>
<p><img src="AnalysingGenoPhenoData_files/figure-html/amr_logistic-1.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Output tables</span></span>
<span><span class="va">models</span><span class="op">$</span><span class="va">modelR</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 5</span></span></span>
<span><span class="co">#&gt;    marker        est ci.lower ci.upper     pval</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> (Intercept) -<span style="color: #BB0000;">4.83</span>   -<span style="color: #BB0000;">5.17</span>   -<span style="color: #BB0000;">4.50</span>   0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> gyrA_S83L    4.00    3.57    4.44   0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> gyrA_D87Y    2.53    0.553   4.50   0.012<span style="text-decoration: underline;">1</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> gyrA_D87N    2.69    1.06    4.32   0.001<span style="text-decoration: underline;">19</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> parC_S80I    3.03    1.42    4.65   0.000<span style="text-decoration: underline;">231</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> parE_S458A  -<span style="color: #BB0000;">2.05</span>   -<span style="color: #BB0000;">4.18</span>    0.072<span style="text-decoration: underline;">4</span> 0.058<span style="text-decoration: underline;">3</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> parC_S80R    1.70   -<span style="color: #BB0000;">0.131</span>   3.53   0.068<span style="text-decoration: underline;">7</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> parE_L416F   1.83   -<span style="color: #BB0000;">1.26</span>    4.92   0.245   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> parC_S57T   -<span style="color: #BB0000;">1.29</span>   -<span style="color: #BB0000;">4.22</span>    1.64   0.388   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> soxS_A12S    2.32   -<span style="color: #BB0000;">0.282</span>   4.93   0.080<span style="text-decoration: underline;">5</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="co">#&gt; Use ggplot2::autoplot() on this output to visualise</span></span>
<span></span>
<span><span class="va">models</span><span class="op">$</span><span class="va">modelNWT</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 5</span></span></span>
<span><span class="co">#&gt;    marker           est ci.lower ci.upper    pval</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> (Intercept) -<span style="color: #BB0000;">1.09</span>     -<span style="color: #BB0000;">1.17</span>      -<span style="color: #BB0000;">1.01</span> 0      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> gyrA_S83L    2.05      1.65       2.45 0      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> gyrA_D87Y    0.584    -<span style="color: #BB0000;">1.02</span>       2.19 0.476  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> gyrA_D87N    2.06      0.616      3.51 0.005<span style="text-decoration: underline;">19</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> parC_S80I    2.81      0.319      5.30 0.027<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> parE_S458A  -<span style="color: #BB0000;">1.61</span>     -<span style="color: #BB0000;">4.38</span>       1.17 0.257  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> parC_S80R    1.08     -<span style="color: #BB0000;">1.77</span>       3.92 0.458  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> parE_L416F  -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">72</span>  -<span style="color: #BB0000;">3.06</span>       3.06 0.999  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> parC_S57T    0.782     0.173      1.39 0.011<span style="text-decoration: underline;">9</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> soxS_A12S    1.96      0.086<span style="text-decoration: underline;">7</span>     3.84 0.040<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="co">#&gt; Use ggplot2::autoplot() on this output to visualise</span></span>
<span></span>
<span><span class="co"># Note the matrix output is the same as cip_bin, but without the MIC data as this is not required</span></span>
<span><span class="co">#    for logistic regression.</span></span>
<span><span class="va">models</span><span class="op">$</span><span class="va">bin_mat</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5,258 × 49</span></span></span>
<span><span class="co">#&gt;    id       pheno     R   NWT gyrA_S83L gyrA_D87Y gyrA_D87N parC_S80I parE_S458A</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;sir&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> SAMN031… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>     0     0         0         0         0         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SAMN031… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>     0     0         0         0         0         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> SAMN031… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>     0     0         0         0         0         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> SAMN031… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>     0     0         1         0         0         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> SAMN031… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>     0     0         0         1         0         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> SAMN031… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>     0     0         0         0         0         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> SAMN031… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>     0     0         0         0         0         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> SAMN031… <span style="color: #080808; background-color: #FFAFAF;">  R  </span>     1     1         1         0         1         1          1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> SAMN031… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>     0     0         1         0         0         0          0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> SAMN031… <span style="color: #080808; background-color: #FFAFAF;">  R  </span>     1     1         1         0         1         1          1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,248 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more variables: parC_S80R &lt;dbl&gt;, parE_L416F &lt;dbl&gt;, qnrB6 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   gyrA_D87G &lt;dbl&gt;, parC_S57T &lt;dbl&gt;, parC_E84A &lt;dbl&gt;, soxS_A12S &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   qnrB2 &lt;dbl&gt;, qnrS2 &lt;dbl&gt;, parC_E84K &lt;dbl&gt;, parC_A56T &lt;dbl&gt;, qnrB19 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `aac(6')-Ib-cr5` &lt;dbl&gt;, parC_E84V &lt;dbl&gt;, parE_I529L &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parE_S458T &lt;dbl&gt;, parE_E460D &lt;dbl&gt;, parC_E84G &lt;dbl&gt;, qnrS1 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   marR_S3N &lt;dbl&gt;, `aac(6')-Ib-cr` &lt;dbl&gt;, soxR_R20H &lt;dbl&gt;, qnrB1 &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="assess-solo-positive-predictive-value-of-genetic-markers">5. Assess solo positive predictive value of genetic markers<a class="anchor" aria-label="anchor" href="#assess-solo-positive-predictive-value-of-genetic-markers"></a>
</h3>
<p>The strongest evidence of the effect of an individual genetic marker
on a drug phenotype is its positive predictive value (PPV) for
resistance amongst strains that carry this marker ‘solo’ with no other
markers known to be associated with resistance to the drug class. This
is referred to as ‘solo PPV’.</p>
<p>The function <code><a href="../reference/solo_ppv_analysis.html">solo_ppv_analysis()</a></code> takes as input our
genotype and phenotype tables, and calculates solo PPV for resistance to
a specific drug (included in our phenotype table) formarkers associated
with the specified drug class (included in our genotype table). It uses
the <code><a href="../reference/get_binary_matrix.html">get_binary_matrix()</a></code> function to first calculate the
binary matrix, then filters out all samples that have more than one
marker.</p>
<p>It then calculates for each remaining marker, amongst the genomes in
which that marker is found solo, the number of genomes, the number and
proportion that are R or NWT, and the 95% confidence intervals for these
proportions. The values are returned as a table, and also plotted so we
can easily visualise the distribution of S/I/R calls and the solo PPV
for R and NWT, for each solo marker.</p>
<p>The function returns 4 objects:</p>
<ul>
<li><p><code>solo_stats</code>: data frame containing the numbers,
proportions and confidence intervals for PPV of R and NWT
categories</p></li>
<li><p><code>amr_binary</code>: the (wide format) binary matrix for all
strains with geno/pheno data for the specified drug/class</p></li>
<li><p><code>solo_binary</code>: the (long format) binary matrix for
only those strains in which a solo marker was found, i.e. the data used
to calculate PPV</p></li>
<li><p><code>combined_plot</code>: a plot showing the distribution of
S/I/R calls and the solo PPV for R and NWT, for each solo
marker</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run a solo PPV analysis</span></span>
<span><span class="va">soloPPV_cipro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solo_ppv_analysis.html">solo_ppv_analysis</a></span><span class="op">(</span><span class="va">ecoli_geno</span>, <span class="va">ecoli_ast</span>, antibiotic <span class="op">=</span> <span class="st">"Ciprofloxacin"</span>, drug_class_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Quinolones"</span><span class="op">)</span>, sir_col <span class="op">=</span> <span class="st">"pheno"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Some samples had multiple phenotype rows, taking the most resistant only"</span></span>
<span><span class="co">#&gt; [1] "Defining NWT using ecoff column provided: ecoff"</span></span></code></pre></div>
<p><img src="AnalysingGenoPhenoData_files/figure-html/solo_ppv_analysis-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Output table</span></span>
<span><span class="va">soloPPV_cipro</span><span class="op">$</span><span class="va">solo_stats</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 44 × 8</span></span></span>
<span><span class="co">#&gt;    marker         category     x     n    ppv      se ci.lower ci.upper</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> aac(6')-Ib-cr5 R            0     1 0      0         0        0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> gyrA_D87G      R            0     4 0      0         0        0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> gyrA_D87N      R            2     6 0.333  0.192     0        0.711 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> gyrA_D87Y      R            0     4 0      0         0        0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> gyrA_S83A      R            0    13 0      0         0        0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> gyrA_S83L      R           29   108 0.269  0.042<span style="text-decoration: underline;">6</span>    0.185    0.352 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> marR_S3N       R           13   524 0.024<span style="text-decoration: underline;">8</span> 0.006<span style="text-decoration: underline;">79</span>   0.011<span style="text-decoration: underline;">5</span>   0.038<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> parC_A56T      R            0     6 0      0         0        0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> parC_S57T      R            0    40 0      0         0        0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> parE_D475E     R            0    91 0      0         0        0     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 34 more rows</span></span></span>
<span></span>
<span><span class="co"># Interim matrices with data used to compute stats and plots</span></span>
<span><span class="va">soloPPV_cipro</span><span class="op">$</span><span class="va">solo_binary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,009 × 8</span></span></span>
<span><span class="co">#&gt;    id           pheno   mic  disk     R   NWT marker    value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;sir&gt;</span> <span style="color: #949494; font-style: italic;">&lt;mic&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dsk&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> SAMN03177618 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.25    <span style="color: #BB0000;">NA</span>     0     0 gyrA_S83L     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SAMN03177619 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.12    <span style="color: #BB0000;">NA</span>     0     0 gyrA_D87Y     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> SAMN03177623 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.25    <span style="color: #BB0000;">NA</span>     0     0 gyrA_S83L     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> SAMN03177631 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.25    <span style="color: #BB0000;">NA</span>     0     0 gyrA_S83L     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> SAMN03177635 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.25    <span style="color: #BB0000;">NA</span>     0     0 gyrA_S83L     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> SAMN03177637 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.25    <span style="color: #BB0000;">NA</span>     0     0 gyrA_S83L     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> SAMN03177638 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.25    <span style="color: #BB0000;">NA</span>     0     0 qnrB6         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> SAMN03177639 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.12    <span style="color: #BB0000;">NA</span>     0     0 gyrA_S83L     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> SAMN03177643 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.25    <span style="color: #BB0000;">NA</span>     0     0 gyrA_S83L     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> SAMN03177646 <span style="color: #080808; background-color: #5FD7AF;">  S  </span>  0.25    <span style="color: #BB0000;">NA</span>     0     0 gyrA_S83L     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 999 more rows</span></span></span>
<span></span>
<span><span class="va">soloPPV_cipro</span><span class="op">$</span><span class="va">amr_binary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5,258 × 51</span></span></span>
<span><span class="co">#&gt;    id    pheno     mic  disk     R   NWT gyrA_S83L gyrA_D87Y gyrA_D87N parC_S80I</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;sir&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;mic&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dsk&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> SAMN… <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015    <span style="color: #BB0000;">NA</span>     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SAMN… <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015    <span style="color: #BB0000;">NA</span>     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> SAMN… <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015    <span style="color: #BB0000;">NA</span>     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> SAMN… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>   0.25<span style="color: #555555;">0</span>    <span style="color: #BB0000;">NA</span>     0     0         1         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> SAMN… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>   0.12<span style="color: #555555;">0</span>    <span style="color: #BB0000;">NA</span>     0     0         0         1         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> SAMN… <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015    <span style="color: #BB0000;">NA</span>     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> SAMN… <span style="color: #080808; background-color: #5FD7AF;">  S  </span> <span style="color: #555555;">&lt;=</span>0.015    <span style="color: #BB0000;">NA</span>     0     0         0         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> SAMN… <span style="color: #080808; background-color: #FFAFAF;">  R  </span>  <span style="color: #555555;">&gt;</span>4<span style="color: #555555;">.000</span>    <span style="color: #BB0000;">NA</span>     1     1         1         0         1         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> SAMN… <span style="color: #080808; background-color: #5FD7AF;">  S  </span>   0.25<span style="color: #555555;">0</span>    <span style="color: #BB0000;">NA</span>     0     0         1         0         0         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> SAMN… <span style="color: #080808; background-color: #FFAFAF;">  R  </span>  <span style="color: #555555;">&gt;</span>4<span style="color: #555555;">.000</span>    <span style="color: #BB0000;">NA</span>     1     1         1         0         1         1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,248 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 41 more variables: parE_S458A &lt;dbl&gt;, parC_S80R &lt;dbl&gt;, parE_L416F &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   qnrB6 &lt;dbl&gt;, gyrA_D87G &lt;dbl&gt;, parC_S57T &lt;dbl&gt;, parC_E84A &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   soxS_A12S &lt;dbl&gt;, qnrB2 &lt;dbl&gt;, qnrS2 &lt;dbl&gt;, parC_E84K &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parC_A56T &lt;dbl&gt;, qnrB19 &lt;dbl&gt;, `aac(6')-Ib-cr5` &lt;dbl&gt;, parC_E84V &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parE_I529L &lt;dbl&gt;, parE_S458T &lt;dbl&gt;, parE_E460D &lt;dbl&gt;, parC_E84G &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   qnrS1 &lt;dbl&gt;, marR_S3N &lt;dbl&gt;, `aac(6')-Ib-cr` &lt;dbl&gt;, soxR_R20H &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-markers-with-assay-data">6. Compare markers with assay data<a class="anchor" aria-label="anchor" href="#compare-markers-with-assay-data"></a>
</h3>
<p>So far we have considered only the impact of individual markers, and
their association with categorical S/I/R or WT/NWT calls.</p>
<p>The function <code><a href="../reference/amr_upset.html">amr_upset()</a></code> takes as binary matrix table
<code>cip_bin</code> summarising ciprofloxacin resistance vs quinolone
markers, generated using <code><a href="../reference/get_binary_matrix.html">get_binary_matrix()</a></code>, and explores
the distribution of MIC or disk diffusion assay values for all observed
combinations of markers (solo or multiple markers). It visualises the
data in the form of an upset plot, showing the distribution of assay
values and S/I/R calls for each observed marker combination, and returns
a summary of these distributions (including sample size, median and
interquartile range, number and proportion classified as R).</p>
<p>The function returns 2 objects:</p>
<ul>
<li><p><code>summary</code>: data frame containing summarising the data
associated with each combination of markers</p></li>
<li><p><code>plot</code>: an upset plot showing the distribution of
assay values, and breakdown of S/I/R calls, for each observed marker
combination</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare ciprofloxacin MIC data with quinolone marker combinations,</span></span>
<span><span class="co">#    using the binary matrix we constructed earlier via get_binary_matrix()</span></span>
<span><span class="va">cipro_mic_upset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amr_upset.html">amr_upset</a></span><span class="op">(</span><span class="va">cip_bin</span>, min_set_size <span class="op">=</span> <span class="fl">2</span>, assay <span class="op">=</span> <span class="st">"mic"</span>, order <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AnalysingGenoPhenoData_files/figure-html/amr_upset-1.png" width="100%"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Output table</span></span>
<span><span class="va">cipro_mic_upset</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 110 × 8</span></span></span>
<span><span class="co">#&gt;    marker_list             marker_count median   q25   q75     ppv     R     n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">""</span>                                 0  0.015 0.015  0.25 0.007<span style="text-decoration: underline;">57</span>    26  <span style="text-decoration: underline;">3</span>436</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">"</span>qnrB<span style="color: #949494;">"</span>                             1  2     2      2    1           1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">"</span>qnrB7<span style="color: #949494;">"</span>                            1  1     1      1    1           1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">"</span>parE_E460K, gyrA_S83W<span style="color: #949494;">"</span>            2  4     4      4    1           1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">"</span>parE_D475E<span style="color: #949494;">"</span>                       1  0.015 0.015  0.5  0           0    91</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">"</span>qnrA1<span style="color: #949494;">"</span>                            1  0.12  0.12   0.12 0           0     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">"</span>gyrA_S83A<span style="color: #949494;">"</span>                        1  0.5   0.5    0.5  0           0    13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">"</span>qnrB4<span style="color: #949494;">"</span>                            1  0.5   0.5    0.75 0.286       2     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">"</span>parE_I355T<span style="color: #949494;">"</span>                       1  0.015 0.015  0.5  0           0    40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">"</span>marR_S3N<span style="color: #949494;">"</span>                         1  0.5   0.5    0.5  0.024<span style="text-decoration: underline;">8</span>     13   524</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 100 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-reference-mic-distributions-and-compare-to-your-data">7. Download reference MIC distributions and compare to your
data<a class="anchor" aria-label="anchor" href="#download-reference-mic-distributions-and-compare-to-your-data"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get MIC distribution for ciprofloxacin, for all organisms</span></span>
<span><span class="fu"><a href="../reference/get_eucast_amr_distribution.html">get_eucast_mic_distribution</a></span><span class="op">(</span><span class="st">"cipro"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,033 × 4</span></span></span>
<span><span class="co">#&gt;    microorganism              microorganism_code   mic count</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;mo&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;mic&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.002     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.004     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.008     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.016     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.03<span style="color: #555555;">0</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.06<span style="color: #555555;">0</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.125     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.25<span style="color: #555555;">0</span>     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      0.5<span style="color: #555555;">00</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Achromobacter xylosoxidans <span style="color: #949494;">B_</span>ACHRMB<span style="color: #949494;">_</span>XYLS      1<span style="color: #555555;">.000</span>     6</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,023 more rows</span></span></span>
<span></span>
<span><span class="co"># specify microorganism to only get results for that pathogen</span></span>
<span><span class="va">ecoli_cip_mic_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_eucast_amr_distribution.html">get_eucast_mic_distribution</a></span><span class="op">(</span><span class="st">"cipro"</span>, <span class="st">"E. coli"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get disk diffusion data instead</span></span>
<span><span class="va">ecoli_cip_disk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_eucast_amr_distribution.html">get_eucast_disk_distribution</a></span><span class="op">(</span><span class="st">"cipro"</span>, <span class="st">"E. coli"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the MIC data</span></span>
<span><span class="va">mics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ecoli_cip_mic_data</span><span class="op">$</span><span class="va">mic</span>, <span class="va">ecoli_cip_mic_data</span><span class="op">$</span><span class="va">count</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">mics</span>, ab <span class="op">=</span> <span class="st">"cipro"</span>, mo <span class="op">=</span> <span class="st">"E. coli"</span>, title <span class="op">=</span> <span class="st">"E. coli cipro reference distribution"</span><span class="op">)</span></span></code></pre></div>
<p><img src="AnalysingGenoPhenoData_files/figure-html/get_eucast_distribution-1.png" width="100%"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare reference distribution to random test data</span></span>
<span><span class="va">my_mic_values</span> <span class="op">&lt;-</span> <span class="fu">AMR</span><span class="fu">::</span><span class="fu"><a href="https://amr-for-r.org/reference/random.html" class="external-link">random_mic</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_eucast_amr_distribution.html">compare_mic_with_eucast</a></span><span class="op">(</span><span class="va">my_mic_values</span>, ab <span class="op">=</span> <span class="st">"cipro"</span>, mo <span class="op">=</span> <span class="st">"E. coli"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(value)`</span></span>
<span><span class="va">comparison</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 3</span></span></span>
<span><span class="co">#&gt;    value    user eucast</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> &lt;=0.001    35      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.002      31     14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.004       0    189</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.005      25      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.008       0   <span style="text-decoration: underline;">3</span>952</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.01       20      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.016       0   <span style="text-decoration: underline;">7</span>238</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0.025      32      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.03        0   <span style="text-decoration: underline;">1</span>355</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.06        0    356</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; Use ggplot2::autoplot() on this output to visualise.</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">)</span></span></code></pre></div>
<p><img src="AnalysingGenoPhenoData_files/figure-html/compare_mic_with_eucast-1.png" width="100%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># Compare reference distribution to example E. coli data</span></span>
<span><span class="va">ecoli_cip</span> <span class="op">&lt;-</span> <span class="va">ecoli_ast</span><span class="op">$</span><span class="va">mic</span><span class="op">[</span><span class="va">ecoli_ast</span><span class="op">$</span><span class="va">drug_agent</span> <span class="op">==</span> <span class="st">"CIP"</span><span class="op">]</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_eucast_amr_distribution.html">compare_mic_with_eucast</a></span><span class="op">(</span><span class="va">ecoli_cip</span>, ab <span class="op">=</span> <span class="st">"cipro"</span>, mo <span class="op">=</span> <span class="st">"E. coli"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(value)`</span></span>
<span><span class="va">comparison</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 36 × 3</span></span></span>
<span><span class="co">#&gt;    value    user eucast</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0.002       0     14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.004       0    189</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.008       0   <span style="text-decoration: underline;">3</span>952</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> &lt;0.015     41      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> &lt;=0.015  <span style="text-decoration: underline;">2</span>642      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.016       0   <span style="text-decoration: underline;">7</span>238</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.03       69   <span style="text-decoration: underline;">1</span>355</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> &lt;=0.06     11      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.06        5    356</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.12       34      0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 26 more rows</span></span></span>
<span><span class="co">#&gt; Use ggplot2::autoplot() on this output to visualise.</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">)</span></span></code></pre></div>
<p><img src="AnalysingGenoPhenoData_files/figure-html/compare_mic_with_eucast-2.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Free and Open Source (GPL-2), brought by amrverse-AMRgen Development Team</p>
</div>

<div class="pkgdown-footer-right">
  <p>Our goal is to develop interpretive standards for AMR genotypes, akin to the interpretive standards developed by EUCAST and CLSI for antimicrobial susceptibility phenotyping.</p>
</div>

    </footer>
</div>





  </body>
</html>
